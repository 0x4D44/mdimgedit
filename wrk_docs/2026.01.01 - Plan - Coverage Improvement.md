# Coverage Improvement Plan
**Date:** 2026-01-01
**Goal:** Increase code coverage to >98%.

## Stage 1: CLI and Arguments
**Focus:** `src/cli/args.rs` and `src/main.rs`
**Tasks:**
1.  Add a unit test in `src/cli/args.rs` to cover all `ResizeFilter` to `FilterType` conversions.
2.  Add a unit test in `src/main.rs` (or `tests/integration_main.rs`) to exercise `command_name` for all variants. This can be done by forcing an error (e.g., input not found) for each command type in a loop or table-driven test.

## Stage 2: Canvas and Composite Operations
**Focus:** `src/ops/canvas.rs`
**Tasks:**
1.  Add unit tests for `canvas_resize` covering all 9 `Anchor` positions.
2.  Add a unit test for `composite` using `BlendMode::Overlay` to hit `overlay_channel`.
3.  Add a unit test for `blend_pixels` where `out_alpha` is near zero (if possible) or accept as defensive coding.

## Stage 3: Error Handling
**Focus:** `src/error.rs`
**Tasks:**
1.  Add unit tests to verify `ImgEditError::code()` and `ImgEditError::exit_code()` for `IoError` and `ImageError` variants.
2.  Add a test case that triggers `ImgEditError::MissingOption` explicitly to verify its code/exit code.

## Stage 4: EXIF Logic
**Focus:** `src/ops/exif.rs`
**Tasks:**
1.  Add comprehensive unit tests for `format_exif_text` by creating `ExifData` structs with various combinations of fields (some present, some missing) to hit all `if let Some(...)` branches.
2.  (Optional) If feasible, find or create a minimal valid EXIF header byte array to test `read_exif` logic, but prioritising the formatting logic coverage first.

## Execution
I will implement these stages sequentially, running coverage checks after each stage to measure progress.
